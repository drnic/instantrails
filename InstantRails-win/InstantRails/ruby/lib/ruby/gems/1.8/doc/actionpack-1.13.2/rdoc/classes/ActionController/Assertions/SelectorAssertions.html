<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: ActionController::Assertions::SelectorAssertions</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">ActionController::Assertions::SelectorAssertions</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/action_controller/assertions/selector_assertions_rb.html">
                lib/action_controller/assertions/selector_assertions.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Adds the <a href="SelectorAssertions.html#M000974">assert_select</a> method
for use in Rails functional test cases.
</p>
<p>
Use <a href="SelectorAssertions.html#M000974">assert_select</a> to make
assertions on the response HTML of a controller action. You can also call
<a href="SelectorAssertions.html#M000974">assert_select</a> within another
<a href="SelectorAssertions.html#M000974">assert_select</a> to make
assertions on elements selected by the enclosing assertion.
</p>
<p>
Use <a href="SelectorAssertions.html#M000973">css_select</a> to select
elements without making an assertions, either from the response HTML or
elements selected by the enclosing assertion.
</p>
<p>
In addition to HTML responses, you can make the following assertions:
</p>
<ul>
<li><a href="SelectorAssertions.html#M000975">assert_select_rjs</a> &#8212;
Assertions on HTML content of RJS update and

<pre>
  insertion operations.
</pre>
</li>
<li><a href="SelectorAssertions.html#M000976">assert_select_encoded</a> &#8212;
Assertions on HTML encoded inside XML,

<pre>
  for example for dealing with feed item descriptions.
</pre>
</li>
<li><a href="SelectorAssertions.html#M000977">assert_select_email</a> &#8212;
Assertions on the HTML body of an e-mail.

</li>
</ul>
<p>
Also see <a href="../../HTML/Selector.html">HTML::Selector</a> for learning
how to use selectors.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000974">assert_select</a>&nbsp;&nbsp;
      <a href="#M000977">assert_select_email</a>&nbsp;&nbsp;
      <a href="#M000976">assert_select_encoded</a>&nbsp;&nbsp;
      <a href="#M000975">assert_select_rjs</a>&nbsp;&nbsp;
      <a href="#M000973">css_select</a>&nbsp;&nbsp;
      <a href="#M000978">response_from_page_or_rjs</a>&nbsp;&nbsp;
      <a href="#M000979">unescape_rjs</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">RJS_STATEMENTS</td>
          <td>=</td>
          <td class="context-item-value">{             :replace              =&gt; /Element\.replace/,             :replace_html         =&gt; /Element\.update/,             :chained_replace      =&gt; /\.replace/,             :chained_replace_html =&gt; /\.update/,           }</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">RJS_INSERTIONS</td>
          <td>=</td>
          <td class="context-item-value">[:top, :bottom, :before, :after]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">RJS_PATTERN_HTML</td>
          <td>=</td>
          <td class="context-item-value">/&quot;((\\&quot;|[^&quot;])*)&quot;/</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">RJS_PATTERN_EVERYTHING</td>
          <td>=</td>
          <td class="context-item-value">Regexp.new(&quot;#{RJS_STATEMENTS[:any]}\\(\&quot;([^\&quot;]*)\&quot;, #{RJS_PATTERN_HTML}\\)&quot;,                                               Regexp::MULTILINE)</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">RJS_PATTERN_UNICODE_ESCAPED_CHAR</td>
          <td>=</td>
          <td class="context-item-value">/\\u([0-9a-zA-Z]{4})/</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000974" class="method-detail">
        <a name="M000974"></a>

        <div class="method-heading">
          <a href="SelectorAssertions.src/M000974.html" target="Code" class="method-signature"
            onclick="popupCode('SelectorAssertions.src/M000974.html');return false;">
          <span class="method-name">assert_select(selector, equality?, message?)<br />
assert_select(element, selector, equality?, message?)<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
An assertion that selects elements and makes one or more equality tests.
</p>
<p>
If the first argument is an element, selects all matching elements starting
from (and including) that element and all its children in depth-first
order.
</p>
<p>
If no element if specified, calling <a
href="SelectorAssertions.html#M000974">assert_select</a> will select from
the response HTML. Calling <a
href="SelectorAssertions.html#M000974">assert_select</a> inside an <a
href="SelectorAssertions.html#M000974">assert_select</a> block will run the
assertion for each element selected by the enclosing assertion.
</p>
<p>
For example:
</p>
<pre>
  assert_select &quot;ol&gt;li&quot; do |elements|
    elements.each do |element|
      assert_select element, &quot;li&quot;
    end
  end
</pre>
<p>
Or for short:
</p>
<pre>
  assert_select &quot;ol&gt;li&quot; do
    assert_select &quot;li&quot;
  end
</pre>
<p>
The selector may be a CSS selector expression (<tt>String</tt>), an
expression with substitution values, or an <a
href="../../HTML/Selector.html">HTML::Selector</a> object.
</p>
<h3>Equality Tests</h3>
<p>
The equality test may be one of the following:
</p>
<ul>
<li><tt>true</tt> &#8212; Assertion is true if at least one element selected.

</li>
<li><tt>false</tt> &#8212; Assertion is true if no element selected.

</li>
<li><tt>String/Regexp</tt> &#8212; Assertion is true if the text value of at
least one element matches the string or regular expression.

</li>
<li><tt>Integer</tt> &#8212; Assertion is true if exactly that number of
elements are selected.

</li>
<li><tt>Range</tt> &#8212; Assertion is true if the number of selected elements
fit the range.

</li>
</ul>
<p>
If no equality test specified, the assertion is true if at least one
element selected.
</p>
<p>
To perform more than one equality tests, use a hash with the following
keys:
</p>
<ul>
<li><tt>:text</tt> &#8212; Narrow the selection to elements that have this text
value (string or regexp).

</li>
<li><tt>:html</tt> &#8212; Narrow the selection to elements that have this HTML
content (string or regexp).

</li>
<li><tt>:count</tt> &#8212; Assertion is true if the number of selected
elements is equal to this value.

</li>
<li><tt>:minimum</tt> &#8212; Assertion is true if the number of selected
elements is at least this value.

</li>
<li><tt>:maximum</tt> &#8212; Assertion is true if the number of selected
elements is at most this value.

</li>
</ul>
<p>
If the method is called with a block, once all equality tests are evaluated
the block is called with an array of all matched elements.
</p>
<h3>Examples</h3>
<pre>
  # At least one form element
  assert_select &quot;form&quot;

  # Form element includes four input fields
  assert_select &quot;form input&quot;, 4

  # Page title is &quot;Welcome&quot;
  assert_select &quot;title&quot;, &quot;Welcome&quot;

  # Page title is &quot;Welcome&quot; and there is only one title element
  assert_select &quot;title&quot;, {:count=&gt;1, :text=&gt;&quot;Welcome&quot;},
      &quot;Wrong title or more than one title element&quot;

  # Page contains no forms
  assert_select &quot;form&quot;, false, &quot;This page must contain no forms&quot;

  # Test the content and style
  assert_select &quot;body div.header ul.menu&quot;

  # Use substitution values
  assert_select &quot;ol&gt;li#?&quot;, /item-\d+/

  # All input fields in the form have a name
  assert_select &quot;form input&quot; do
    assert_select &quot;[name=?]&quot;, /.+/  # Not empty
  end
</pre>
        </div>
      </div>

      <div id="method-M000977" class="method-detail">
        <a name="M000977"></a>

        <div class="method-heading">
          <a href="SelectorAssertions.src/M000977.html" target="Code" class="method-signature"
            onclick="popupCode('SelectorAssertions.src/M000977.html');return false;">
          <span class="method-name">assert_select_email { }<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Extracts the body of an email and runs nested assertions on it.
</p>
<p>
You must enable deliveries for this assertion to work, use:
</p>
<pre>
  ActionMailer::Base.perform_deliveries = true
</pre>
<h3>Example</h3>
<p>
<a href="SelectorAssertions.html#M000977">assert_select_email</a> do
</p>
<pre>
  assert_select &quot;h1&quot;, &quot;Email alert&quot;
</pre>
<p>
end
</p>
        </div>
      </div>

      <div id="method-M000976" class="method-detail">
        <a name="M000976"></a>

        <div class="method-heading">
          <a href="SelectorAssertions.src/M000976.html" target="Code" class="method-signature"
            onclick="popupCode('SelectorAssertions.src/M000976.html');return false;">
          <span class="method-name">assert_select_encoded(element?) { |elements| ... }<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Extracts the content of an element, treats it as encoded HTML and runs
nested assertion on it.
</p>
<p>
You typically call this method within another assertion to operate on all
currently selected elements. You can also pass an element or array of
elements.
</p>
<p>
The content of each element is un-encoded, and wrapped in the root element
<tt>encoded</tt>. It then calls the block with all un-encoded elements.
</p>
<h3>Example</h3>
<pre>
  assert_select_feed :rss, 2.0 do
    # Select description element of each feed item.
    assert_select &quot;channel&gt;item&gt;description&quot; do
      # Run assertions on the encoded elements.
      assert_select_encoded do
        assert_select &quot;p&quot;
      end
    end
  end
</pre>
        </div>
      </div>

      <div id="method-M000975" class="method-detail">
        <a name="M000975"></a>

        <div class="method-heading">
          <a href="SelectorAssertions.src/M000975.html" target="Code" class="method-signature"
            onclick="popupCode('SelectorAssertions.src/M000975.html');return false;">
          <span class="method-name">assert_select_rjs(id?) { |elements| ... }<br />
assert_select_rjs(statement, id?) { |elements| ... }<br />
assert_select_rjs(:insert, position, id?) { |elements| ... }<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Selects content from the RJS response.
</p>
<h3>Narrowing down</h3>
<p>
With no arguments, asserts that one or more elements are updated or
inserted by RJS statements.
</p>
<p>
Use the <tt>id</tt> argument to narrow down the assertion to only
statements that update or insert an element with that identifier.
</p>
<p>
Use the first argument to narrow down assertions to only statements of that
type. Possible values are +:replace+, +:replace_html+ and +:insert_html+.
</p>
<p>
Use the argument +:insert+ followed by an insertion position to narrow down
the assertion to only statements that insert elements in that position.
Possible values are +:top+, +:bottom+, +:before+ and +:after+.
</p>
<h3>Using blocks</h3>
<p>
Without a block, <a
href="SelectorAssertions.html#M000975">assert_select_rjs</a> merely asserts
that the response contains one or more RJS statements that replace or
update content.
</p>
<p>
With a block, <a
href="SelectorAssertions.html#M000975">assert_select_rjs</a> also selects
all elements used in these statements and passes them to the block. Nested
assertions are supported.
</p>
<p>
Calling <a href="SelectorAssertions.html#M000975">assert_select_rjs</a>
with no arguments and using nested asserts asserts that the HTML content is
returned by one or more RJS statements. Using <a
href="SelectorAssertions.html#M000974">assert_select</a> directly makes the
same assertion on the content, but without distinguishing whether the
content is returned in an HTML or JavaScript.
</p>
<h3>Examples</h3>
<pre>
  # Replacing the element foo.
  # page.replace 'foo', ...
  assert_select_rjs :replace, &quot;foo&quot;

  # Replacing with the chained RJS proxy.
  # page[:foo].replace ...
  assert_select_rjs :chained_replace, 'foo'

  # Inserting into the element bar, top position.
  assert_select_rjs :insert, :top, &quot;bar&quot;

  # Changing the element foo, with an image.
  assert_select_rjs &quot;foo&quot; do
    assert_select &quot;img[src=/images/logo.gif&quot;&quot;
  end

  # RJS inserts or updates a list with four items.
  assert_select_rjs do
    assert_select &quot;ol&gt;li&quot;, 4
  end

  # The same, but shorter.
  assert_select &quot;ol&gt;li&quot;, 4
</pre>
        </div>
      </div>

      <div id="method-M000973" class="method-detail">
        <a name="M000973"></a>

        <div class="method-heading">
          <a href="SelectorAssertions.src/M000973.html" target="Code" class="method-signature"
            onclick="popupCode('SelectorAssertions.src/M000973.html');return false;">
          <span class="method-name">css_select(selector) => array<br />
css_select(element, selector) => array<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Select and return all matching elements.
</p>
<p>
If called with a single argument, uses that argument as a selector to match
all elements of the current page. Returns an empty array if no match is
found.
</p>
<p>
If called with two arguments, uses the first argument as the base element
and the second argument as the selector. Attempts to match the base element
and any of its children. Returns an empty array if no match is found.
</p>
<p>
The selector may be a CSS selector expression (<tt>String</tt>), an
expression with substitution values (<tt>Array</tt>) or an <a
href="../../HTML/Selector.html">HTML::Selector</a> object.
</p>
<p>
For example:
</p>
<pre>
  forms = css_select(&quot;form&quot;)
  forms.each do |form|
    inputs = css_select(form, &quot;input&quot;)
    ...
  end
</pre>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000978" class="method-detail">
        <a name="M000978"></a>

        <div class="method-heading">
          <a href="SelectorAssertions.src/M000978.html" target="Code" class="method-signature"
            onclick="popupCode('SelectorAssertions.src/M000978.html');return false;">
          <span class="method-name">response_from_page_or_rjs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="SelectorAssertions.html#M000974">assert_select</a> and <a
href="SelectorAssertions.html#M000973">css_select</a> call this to obtain
the content in the HTML page, or from all the RJS statements, depending on
the type of response.
</p>
        </div>
      </div>

      <div id="method-M000979" class="method-detail">
        <a name="M000979"></a>

        <div class="method-heading">
          <a href="SelectorAssertions.src/M000979.html" target="Code" class="method-signature"
            onclick="popupCode('SelectorAssertions.src/M000979.html');return false;">
          <span class="method-name">unescape_rjs</span><span class="method-args">(rjs_string)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Unescapes a RJS string.
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>